<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>問題と答え</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 8px;
      text-align: left;
    }

    .hidden {
      display: none;
    }

    .answer {
      color: red;
    }

    .left-align {
      text-align: left;
      display: inline-block;
      margin: 0 auto;
    }

    .question {
      text-align: left;
      text-decoration: underline;
      margin: 32px 0 0px 0;
    }

    .choice-container {
      display: flex;
      align-items: center;
    }

    .choice-button {
      margin-right: 10px;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
</head>

<body>
  <h1>問題</h1>
  <div><input type="file" id="fileInput" accept=".xlsx, .xls"></div>
  <hr>
  <div id="question-header" class="left-align">
    <span id="question-number"></span>
    <button onclick="resetQuestions()">リセット</button>
  </div>
  <div id="question" class="question"></div>
  <br>
  <div id="choices" class="left-align"></div>
  <div>
    <button onclick="prevQuestion()">前の問題</button>
    <button onclick="nextQuestion()">次の問題</button>
  </div>

  <script>
    let questions = [];
    let currentQuestionIndex = 0;

    document.getElementById('fileInput').addEventListener('change', handleFileSelect, false);

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: 'array' });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
          processExcelData(jsonData);
        };
        reader.readAsArrayBuffer(file);
      }
    }

    function processExcelData(data) {
      questions = data.slice(1).map(row => ({
        question: row[0],
        choices: [
          { text: row[1], isCorrect: row[2] === '◯' },
          { text: row[3], isCorrect: row[4] === '◯' }
        ]
      }));
      currentQuestionIndex = 0; // Reset the current question index
      shuffle(questions);
      displayQuestion(currentQuestionIndex);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function displayQuestion(index) {
      const question = questions[index];
      document.getElementById('question-number').textContent = `${index + 1}/${questions.length}`;
      document.getElementById('question').textContent = question.question;

      const choicesDiv = document.getElementById('choices');
      choicesDiv.innerHTML = '';
      shuffle(question.choices);
      question.choices.forEach((choice, idx) => {
        const choiceContainer = document.createElement('div');
        choiceContainer.className = 'choice-container';

        const choiceButton = document.createElement('button');
        choiceButton.textContent = '◯';
        choiceButton.className = 'choice-button';
        choiceButton.onclick = () => showAnswer();

        const choiceElement = document.createElement('p');
        choiceElement.textContent = choice.text;
        choiceElement.id = `choice${idx + 1}`;

        choiceContainer.appendChild(choiceButton);
        choiceContainer.appendChild(choiceElement);
        choicesDiv.appendChild(choiceContainer);
      });

      // 答えを非表示にする
      document.querySelectorAll('#choices p').forEach(element => {
        element.style.color = '';
      });
    }

    function showAnswer() {
      const question = questions[currentQuestionIndex];
      question.choices.forEach((choice, idx) => {
        const choiceElement = document.getElementById(`choice${idx + 1}`);
        if (choice.isCorrect) {
          choiceElement.style.color = 'red';
        }
      });
    }

    function nextQuestion() {
      currentQuestionIndex++;
      if (currentQuestionIndex >= questions.length) {
        currentQuestionIndex = 0; // 最初の問題に戻る
      }
      displayQuestion(currentQuestionIndex);
    }

    function prevQuestion() {
      currentQuestionIndex--;
      if (currentQuestionIndex < 0) {
        currentQuestionIndex = questions.length - 1; // 最後の問題に戻る
      }
      displayQuestion(currentQuestionIndex);
    }

    function resetQuestions() {
      currentQuestionIndex = 0;
      shuffle(questions); // 問題の順番を再度ランダムにする
      displayQuestion(currentQuestionIndex);
    }
  </script>

</body>

</html>
